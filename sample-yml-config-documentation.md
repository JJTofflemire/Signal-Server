Sample.yml Config Documentation
=================

Dependancies
-----------------

- Required:

  - [AWS](#aws-iam-configuration)
  
  - [GCP](#gcp-configuration)

  - [Redis](#redis-notes)

- Optional, just make sure the values aren't empty (`unset` should work)

  - Braintree

  - Datadog

  - Stripe
  
  - paymentsService
  
  - subscription
  
  - oneTimeDoncations
  
- Unknown (will get sorted into the above)
  
  - DirectoryV2
  
  - svr2
  
  - apn
  
  - fcm
  
  - unidentifiedDelivery
  
  - recaptcha
  
  - hCaptcha
  
  - storageService
  
  - backupService
  
  - zkConfig
  
  - genericZkConfig
  
  - appConfig
  
  - remoteConfig
  
  - artService
  
  - badges
  
  - registrationService

- [Here is an example of sample.yml with some shorthand comments](sample-with-added-comments.yml) (unfinished)

General / Misc
-----------------

- Specify your AWS region with `sudo nano ~/.bashrc`, add `export AWS_REGION=your-region` to the end of the file, then run `. ~/.bashrc`

AWS IAM Configuration
-----------------

- Create an account with AWS

- Go to IAM and create a user with full access (this is definitely not entirely safe but hey, it gets the job done)
  
- Copy the access key and access secret, and paste them into `awsAttachments.accessKey` and `awsAttachments.accessSecret`, and `cdn.accessKey` and `cdn.accessSecret` in [sample-secrets-bundle](/service/config/sample-secrets-bundle.yml)
  
- If you give the IAM user full access, you can reuse the same access key and secret for both buckets

AWS Buckets Configuration
-----------------

- Go to S3 and create the two buckets below (I don't think you need to change any other settings)
  
  - aws-attachments
  
  - cdn
  
AWS DynamoDb Configuration
-----------------
  
- Sign into AWS, look up DynamoDb, and make tables of all of the following(not sure what to do about Partition Keys)

- If you change these names, also change them in [sample.yml](/service/config/sample.yml)
  
  - Accounts
  
  - Accounts_PhoneNumbers
  
  - Accounts_PhoneNumberIdentifiers
  
  - Accounts_Usernames
  
  - DeletedAccounts
  
  - DeletedAccountsLock
  
  - IssuedReceipts
  
    - expiration: P30D
  
    - generator: abcdefg12345678=
  
  - Keys
  
  - PQ_Keys
  
  - PQ_Last_Resort_Keys
  
  - Messages
  
    - expiration: P30D

  - PendingAccounts

  - PendingDevices

  - PhoneNumberIdentifiers
  
  - Profiles
  
  - PushChallenge
  
  - RedeemedReceipts
  
    - expiration: P30D
  
  - RegistrationRecovery
  
    - expiration: P30D
  
  - RemoteConfig
  
  - ReportMessage
  
  - Subscriptions
  
  - VerificationSessions

GCP Configuration
-----------------

1. Log into Google Cloud and create a service account that can manage the Bucket

    2.1. Select the bucket project

    2.2. In the left navigation panel, select `Service Accounts` under `IAM & ADMIN`

    2.3. In the middle top, select `Create Service Account`

    2.4. Under `Grant this service account access to project`, add the role `Owner` and the role `Cloud KMS CryptoKey Encrypter/Decrypter`
    
    2.5. Copy the email address and paste it into your `sample.yml`

2. Create the bucket

    3.1. In the left navigation panel, select `Buckets` under `Cloud Storage`

    3.2. Hit `CREATE` in the top middle of the screen
  
    3.3. Configure it (default configuration works fine), and select the region you want to use - I used `us (multiple regions in the United States)`

- NOTES: Use just one project, make a service account with key and download the json, make the bucket with google's key, make a secret in secret manager and make it match the secret rsaSigningKey

Redis Notes
-----------------

- Currently the [docker-compose.yml](docker-compose.yml) file has a redis-cluster generated by ChatGPT, using `Localhost` and ports 7000-7002

  - I am currently working both from my MacBook and an Ubuntu desktop, and the MacBook doesn't like this port selection. It could be a firewall or a vpn issue though.df 